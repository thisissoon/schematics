#
# Gitlab configuration for <%= name %>
#

# Stages
stages:
  - setup
  - test

#
# Setup Stage
#

# Setup project
setup:
  stage: setup
  image: circleci/node:8.11.2-browsers
  cache:
    key: ${CI_COMMIT_REF_SLUG}
    untracked: true
    paths:
      - node_modules/
  script:
    - <% if (packageManager === 'npm') { %>npm i --no-progress<% } else { %>yarn --silent<% } %>


#
# Test Stage
#

# Test Unit
test_unit:
  stage: test
  image: circleci/node:8.11.2-browsers
  cache:
    key: ${CI_COMMIT_REF_SLUG}
    untracked: true
    policy: pull
    paths:
      - node_modules/
  before_script:
    - <% if (packageManager === 'npm') { %>npm i --no-progress<% } else { %>yarn --silent<% } %>
  script:
    - <% if (packageManager === 'npm') { %>npm run<% } else { %> yarn<% } %> lint
    - <% if (packageManager === 'npm') { %>npm run<% } else { %> yarn<% } %> test <% if (packageManager === 'npm') { %> -- <% } %>--configuration ci



# Test Integration
test_integration:
  stage: test
  image: circleci/node:8.11.2-browsers
  cache:
    key: ${CI_COMMIT_REF_SLUG}
    untracked: true
    policy: pull
    paths:
      - node_modules/
  before_script:
    - <% if (packageManager === 'npm') { %>npm i --no-progress<% } else { %>yarn --silent<% } %>
  script:
    - <% if (packageManager === 'npm') { %>npm run<% } else { %> yarn<% } %> e2e


